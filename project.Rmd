---
title: "Project Part 1"
author: "Risshi Naavaal, Caleb Adhikari, and Jonas Lee"
fontsize: 12pt
geometry: margin=1in
urlcolor: black
output: pdf_document
header-includes:
- \usepackage{setspace}
- \onehalfspacing
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, highlight=FALSE)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(patchwork)
library(knitr)

data <- read.csv("merged_data_2022_four_variables.csv")
median_health_exp <- median(data$Health_Expenditure_2022)
data$Health_Exp_Group <- ifelse(data$Health_Expenditure_2022 > median_health_exp, 
          "Above Median", "Below Median")
median_gdp_per_capita <- median(data$GDP_per_Capita_2022)
data$GDP_Group <- ifelse(data$GDP_per_Capita_2022 > median_gdp_per_capita, 
          "Above Median", "Below Median")
```

## Introduction 
Often times quality of life is measured by Real GDP per Capita, the higher this is for a country, the higher perceived quality of life its citizens have. However, we believe it is important to look at health outcomes, specifically life expectancy and infant mortality, to measure quality of life. We will be looking at the relationship between health expenditure as a % of GDP and infant mortality and life expectancy at birth to see if additional spending is strongly correlated with better health outcomes. \newline
-Do countries with health expenditure above the median have lower infant mortality rates than countries that spend below the median. \newline
-Do countries with health expenditure above the median have higher life expectancy than those that spend below the median. 
\newline
- Lastly, we will observe countries that have a below median GDP per capita and determine whether from that set of countries, if countries that spend more than 5% on health expenditure have a greater life expectancy than countries that spend less than 5% on health expenditure.

## Data Summary
The data used in our project represents a population. The data was collected from the World Bank Open Data Portal and contained data on territories, countries, and regional groupings across the world. We filtered the data to remove any data that did not represent an individual country, and collected data from 2022 only. Further, when merging the datasets for Health Expenditure, Infant mortality Rate, GDP per Capita, and Life Expectancy, some countries were missing data so we excluded them from the dataset entirely. These countries were Cuba, Eritrea, North Korea, Kosovo, South Sudan, Ukraine, Venezuela, and Yemen. After we completed the data cleaning process, we had a total of 188 countries.

We removed regional groupings to ensure there was no double counting of data, and narrowed our research to countries because territories tend to be missing data.

The data comes from a population, but because we were missing some data for 8 countries, it is not a full population. There could be some missing data bias as the countries that are missing data are similar in that they have political instability(ie. Ukraine and North Korea). This means our data does not fully represent unstable countries. We chose the year 2022, and the data may refelct changes due to the Covid-19 Pandemic, so some of the data like health expenditure as a % of GDP may be inflated.

The data is perfect for our research purposes as we have standard units to measure across all coutnries, and official published data is available. We have a large dataset with 188 observations to reduce variability. Below is a data dictionary for clear understanding of the variables and units. 

## Data Dictionary
``` {r, echo=FALSE}
library(knitr)

# Simplified data dictionary
data_dictionary <- data.frame(
  Variable = c("Country Name", 
               "Country Code", 
               "Health Expenditure", 
               "Infant Mortality Rate", 
               "GDP per Capita", 
               "Life Expectancy"),
  
  Description = c("Official name of the sovereign country",
                  "Three-letter country code assigned to countries (e.g., USA for United States, FRA for France)",
                  "Total spending on health care as a percentage of gross domestic product.",
                  "The number of infant deaths (children under one year old) per 1,000 live births in 2022. Lower values indicate better child survival rates.",
                  "The total economic output of a country divided by its population, expressed in current U.S. dollars. Represents the average income per person.",
                  "The average number of years a newborn is expected to live at birth, measured in years."),
  
  Unit_of_Measurement = c("â€”",
                         "3-letter code",
                         "Percentage of GDP",
                         "Deaths per 1,000 births",
                         "U.S. dollars",
                         "Years")
)

kable(data_dictionary,
      caption = "Data Dictionary",
      col.names = c("Variable Name", "Description", "Unit of Measurement"),
      align = c('l', 'l', 'c'))
```


## Data Exploration
```{r, echo=FALSE}
summary_data <- data %>%
  group_by(Health_Exp_Group) %>%
  summarise(
    Mean_Infant_Mortality = mean(Infant_Mortality_2022),
    Mean_Life_Expectancy = mean(Life_Expectancy_2022)
  )

# Scatter Plot 1: Health Expenditure vs Life Expectancy
sp1 <- ggplot(data, aes(x = Life_Expectancy_2022, y = Health_Expenditure_2022)) +
  geom_point(color = "steelblue", size = 3, alpha = 0.6) +
  labs(title = "Health Expenditure vs Life Expectancy (2022)",
       x = "Life Expectancy (years)",
       y = "Health Expenditure (% of GDP)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 10))

# Scatter Plot 2: Health Expenditure vs Infant Mortality
sp2 <- ggplot(data, aes(x = Infant_Mortality_2022, y = Health_Expenditure_2022)) +
  geom_point(color = "coral", size = 3, alpha = 0.6) +
  labs(title = "Health Expenditure vs Infant Mortality (2022)",
       x = "Infant Mortality (per 1,000 live births)",
       y = "Health Expenditure (% of GDP)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 10))

# Combine side by side
sp1 + sp2


# Calculate summary statistics for all 4 variables
summary_stats <- data.frame(
  Variable = c("Health Expenditure (% of GDP)", 
               "Infant Mortality (per 1,000 births)",
               "GDP per Capita (US$)",
               "Life Expectancy (years)"),
  Mean = c(mean(data$Health_Expenditure_2022),
           mean(data$Infant_Mortality_2022),
           mean(data$GDP_per_Capita_2022),
           mean(data$Life_Expectancy_2022)),
  Median = c(median(data$Health_Expenditure_2022),
             median(data$Infant_Mortality_2022),
             median(data$GDP_per_Capita_2022),
             median(data$Life_Expectancy_2022)),
  Min = c(min(data$Health_Expenditure_2022),
          min(data$Infant_Mortality_2022),
          min(data$GDP_per_Capita_2022),
          min(data$Life_Expectancy_2022)),
  Max = c(max(data$Health_Expenditure_2022),
          max(data$Infant_Mortality_2022),
          max(data$GDP_per_Capita_2022),
          max(data$Life_Expectancy_2022))
)

# Round the numbers
summary_stats[, 2:5] <- round(summary_stats[, 2:5], 2)

# Create a nice table
kable(summary_stats,
      caption = "Summary Statistics for Health and Economic Indicators (2022)",
      align = c('l', 'c', 'c', 'c', 'c'),
      col.names = c("Variable", "Mean", "Median", "Min", "Max"))

# Create compact plots
p1 <- ggplot(summary_data, aes(x = Health_Exp_Group, y = Mean_Infant_Mortality, fill = Health_Exp_Group)) +
  geom_bar(stat = "identity", alpha = 0.8, width = 0.6) +
  geom_text(aes(label = round(Mean_Infant_Mortality, 2)), vjust = -0.5, size = 3.5) +
  labs(title = "Mean Infant Mortality", x = NULL, y = "Infant Mortality (per 1,000)") +
  scale_fill_manual(values = c("Above Median" = "steelblue", "Below Median" = "coral")) +
  theme_minimal() +
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5, size = 10))

p2 <- ggplot(summary_data, aes(x = Health_Exp_Group, y = Mean_Life_Expectancy, fill = Health_Exp_Group)) +
  geom_bar(stat = "identity", alpha = 0.8, width = 0.6) +
  geom_text(aes(label = round(Mean_Life_Expectancy, 2)), vjust = -0.5, size = 3.5) +
  labs(title = "Mean Life Expectancy", x = NULL, y = "Life Expectancy (years)") +
  scale_fill_manual(values = c("Above Median" = "steelblue", "Below Median" = "coral")) +
  theme_minimal() +
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5, size = 10))

# Combine side by side with a title
combined <- (p1 + p2) + 
  plot_annotation(
    title = 'Health Outcomes by Health Expenditure Level (2022)',
    subtitle = 'Comparing countries above and below median health expenditure (6.41% of GDP)',
    theme = theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 12))
  )
combined

# Create correlation matrix
cor_data <- data %>%
  select(Health_Expenditure_2022, Infant_Mortality_2022, 
         GDP_per_Capita_2022, Life_Expectancy_2022)

correlation_matrix <- cor(cor_data)

# Shorten column/row names so they fit better
colnames(correlation_matrix) <- c("Health Exp.", "Infant Mort.", 
                                   "GDP per Cap.", "Life Exp.")
rownames(correlation_matrix) <- c("Health Exp.", "Infant Mort.", 
                                   "GDP per Cap.", "Life Exp.")

# Simple, clean table that will knit without issues
kable(round(correlation_matrix, 3),
      caption = "Correlation Matrix of Health and Economic Indicators (2022)",
      align = 'c')

q3data <- data %>%
  filter(GDP_Group=="Below Median") %>%
  mutate(health_exp_greater_than_5 = ifelse(Health_Expenditure_2022 > 5, "Above 5%", "Below 5%"))

q3_summary <- q3data %>%
    group_by(health_exp_greater_than_5) %>%
    summarise(Mean_Life_Expectancy = mean(Life_Expectancy_2022))
  
sp3 <- ggplot(q3data, aes(x=Health_Expenditure_2022, y=Life_Expectancy_2022)) +
  geom_point(color = "steelblue", size = 3, alpha = 0.6) +
  geom_vline(xintercept = 5, linetype = "dashed", color = "red", linewidth = 1) +
  labs(title = "Life Expectancy vs Health Expenditure",
       subtitle = "Countries with Below Median GDP per Capita",
       x = "Health Expenditure (% of GDP)",
       y = "Life Expectancy (years)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 9),
        plot.subtitle = element_text(hjust = 0.5, size = 8),
        axis.title = element_text(size = 8),
        axis.text = element_text(size = 7))

# Second plot - bar chart (smaller fonts)
bp3 <- ggplot(q3_summary, aes(x = health_exp_greater_than_5, y = Mean_Life_Expectancy, fill = health_exp_greater_than_5)) +
  geom_bar(stat = "identity", alpha = 0.8, width = 0.5) +
  geom_text(aes(label = round(Mean_Life_Expectancy, 2)), vjust = -0.5, size = 3.5) +
  labs(title = "Mean Life Expectancy by Health Expenditure",
       subtitle = "Countries with Below Median GDP per Capita",
       x = NULL,
       y = "Life Expectancy (years)") +
  scale_fill_manual(values = c("Above 5%" = "steelblue", "Below 5%" = "coral")) +
  theme_minimal() +
  theme(legend.position = "none", 
        plot.title = element_text(hjust = 0.5, face = "bold", size = 9),
        plot.subtitle = element_text(hjust = 0.5, size = 8),
        axis.title = element_text(size = 8),
        axis.text = element_text(size = 7))

# Combine side by side
sp3 + bp3
```

\newpage
## Conclusions
### Research Question \#1: Health Expenditure and Infant Mortality
Countries that spend more than the median on health (6.43% of GDP) have relatively lower infant mortality rates-15.48 deaths per 1,000 births versus 24.54 for below-median spenders. This 37% difference suggests that higher health spending indeed buys better child survival. However, the correlation is weak at -0.162, and the scatterplot shows a great deal of variation around the trend, including several low-spending countries with good outcomes and some high-spending countries with poor results. This indicates that it is not the level of spending that determines infant mortality but rather how the resources are used.

### Research Question \#2: Health Expenditure and Life Expectancy
The above-median health spenders have a 3.2-year life expectancy advantage, 74.03 versus 70.79 years. Again, this correlation is weak at 0.153. The scatter plot shows country life expectancies from 50 to 80 years when health spending as a percent of GDP is the same. More interestingly, GDP per capita has a much stronger correlation with life expectancy, 0.567, than health expenditure as a percent of GDP does, indicating overall economic success improves longevity more than healthcare spending as a percent of GDP.


### Research Question \#3: Health Expenditure Among Lower-Income Countries
In countries below the median GDP per capita, those that spend above 5% on health only have a life expectancy advantage of 1.1 years (67.98 versus 66.9 years). The scatter plot shows most lower-income countries clustering between 60-75 years regardless of spending level, with no clear separation at thresholds around 5%. This minimal difference suggests that other factors beyond health expenditure percentage has a more influential and larger role.

### Story in the Data
This analysis suggests that higher health spending is associated with better outcomes, but the relationships are surprisingly weak. Spending more on health generally helps but is no guarantee of better results-many countries achieve strong health outcomes at modest spending levels while others spend heavily with disappointing returns. Economic development would appear more influential than health expenditure percentage, with stronger associations of GDP per capita with both infant mortality and life expectancy. The very strong link between infant mortality and life expectancy suggests that systems effective at keeping children alive also support health throughout life. The critical insight is that how money is spent-through efficient systems, equitable distribution, and strategic allocation-matters more than how much is spent. For policymakers, adequate funding is a necessary but not sufficient condition; countries must also focus their attention on healthcare system efficiency, primary care, preventive services, and broader social determinants of health.

\newpage
## Data Appendix
```{r}
head(data, 15)
```

\newpage
## References
-Anthropic. (2024). Claude (Version 3.5 and Sonnet 4.5) [Large language model]. https://www.anthropic.com/claude\newline

-World Bank. (2024). GDP per capita (current US$) [Data set]. World Bank Open Data. https://data.worldbank.org/indicator/NY.GDP.PCAP.CD\newline

-World Bank. (2024). Life expectancy at birth, total (years) [Data set]. World Bank Open Data. https://data.worldbank.org/indicator/SP.DYN.LE00.IN\newline

-World Bank. (2024). Mortality rate, infant (per 1,000 live births) [Data set]. World Bank Open Data. https://data.worldbank.org/indicator/SP.DYN.IMRT.IN\newline

-World Bank. (2024). Current health expenditure (% of GDP) [Data set]. World Bank Open Data. https://data.worldbank.org/indicator/SH.XPD.CHEX.GD.ZS

